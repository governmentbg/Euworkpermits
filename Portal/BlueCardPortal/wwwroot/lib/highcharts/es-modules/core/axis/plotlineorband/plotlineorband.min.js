"use strict";import PlotLineOrBandAxis from"./PlotLineOrBandAxis.js";import U from"../../Utilities.js";const{arrayMax,arrayMin,defined,destroyObjectProperties,erase,fireEvent,merge,objectEach,pick}=U;class PlotLineOrBand{static compose(e){return PlotLineOrBandAxis.compose(PlotLineOrBand,e)}constructor(e,t){this.axis=e,this.options=t,this.id=t.id}render(){fireEvent(this,"render");const{axis:e,options:t}=this,{horiz:i,logarithmic:r}=e,{color:a,events:s,zIndex:d=0}=t,n={},l=e.chart.renderer,o=t.to,h=t.from,c=t.value,g=t.borderWidth;let f=t.label,{label:x,svgElem:p}=this,m=[],y;const b=defined(h)&&defined(o),u=defined(c),v=!p,L={class:"highcharts-plot-"+(b?"band ":"line ")+(t.className||"")};var P=b?"bands":"lines";if(e.chart.styledMode||(u?(L.stroke=a||"#999999",L["stroke-width"]=pick(t.width,1),t.dashStyle&&(L.dashstyle=t.dashStyle)):b&&(L.fill=a||"#e6e9ff",g&&(L.stroke=t.borderColor,L["stroke-width"]=g))),P+="-"+(n.zIndex=d),(y=e.plotLinesAndBandsGroups[P])||(e.plotLinesAndBandsGroups[P]=y=l.g("plot-"+P).attr(n).add()),p||(this.svgElem=p=l.path().attr(L).add(y)),defined(c))m=e.getPlotLinePath({value:r?.log2lin(c)??c,lineWidth:p.strokeWidth(),acrossPanes:t.acrossPanes});else{if(!defined(h)||!defined(o))return;m=e.getPlotBandPath(r?.log2lin(h)??h,r?.log2lin(o)??o,t)}return!this.eventsAdded&&s&&(objectEach(s,(e,t)=>{p?.on(t,e=>{s[t].apply(this,[e])})}),this.eventsAdded=!0),!v&&p.d||!m?.length?p&&(m?(p.show(),p.animate({d:m})):p.d&&(p.hide(),x&&(this.label=x=x.destroy()))):p.attr({d:m}),f&&(defined(f.text)||defined(f.formatter))&&m?.length&&0<e.width&&0<e.height&&!m.isFlat?(f=merge({align:i&&b?"center":void 0,x:i?!b&&4:10,verticalAlign:!i&&b?"middle":void 0,y:i?b?16:10:b?6:-4,rotation:i&&!b?90:0},f),this.renderLabel(f,m,b,d)):x&&x.hide(),this}renderLabel(e,t,i,r){const a=this,s=a.axis,d=s.chart.renderer;let n=a.label;n||(a.label=n=d.text(this.getLabelText(e),0,0,e.useHTML).attr({align:e.textAlign||e.align,rotation:e.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(e.className||""),zIndex:r}),s.chart.styledMode||n.css(merge({fontSize:"0.8em",textOverflow:"ellipsis"},e.style)),n.add());var r=t.xBounds||[t[0][1],t[1][1],(i?t[2]:t[0])[1]],i=t.yBounds||[t[0][2],t[1][2],(i?t[2]:t[0])[2]],t=arrayMin(r),l=arrayMin(i);n.align(e,!1,{x:t,y:l,width:arrayMax(r)-t,height:arrayMax(i)-l}),n.alignValue&&"left"!==n.alignValue||(r=e.clip?s.width:s.chart.chartWidth,n.css({width:(90===n.rotation?s.height-(n.alignAttr.y-s.top):r-(n.alignAttr.x-s.left))+"px"})),n.show(!0)}getLabelText(e){return defined(e.formatter)?e.formatter.call(this):e.text}destroy(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)}}export default PlotLineOrBand;