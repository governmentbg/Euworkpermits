"use strict";import Chart from"../Chart/Chart.js";import F from"../Templating.js";const format=F["format"];import D from"../Defaults.js";const getOptions=D["getOptions"];import NavigatorDefaults from"../../Stock/Navigator/NavigatorDefaults.js";import RangeSelectorDefaults from"../../Stock/RangeSelector/RangeSelectorDefaults.js";import ScrollbarDefaults from"../../Stock/Scrollbar/ScrollbarDefaults.js";import StockUtilities from"../../Stock/Utilities/StockUtilities.js";const setFixedRange=StockUtilities["setFixedRange"];import U from"../Utilities.js";const{addEvent,clamp,crisp,defined,extend,find,isNumber,isString,merge,pick,splat}=U;function getDefaultAxisOptions(t,e,i){return"xAxis"===t?{minPadding:0,maxPadding:0,overscroll:0,ordinal:!0}:"yAxis"===t?{labels:{y:-2},opposite:i.opposite??e.opposite??!0,showLastLabel:!(!e.categories&&"category"!==e.type),title:{text:"Values"!==i.title?.text?i.title?.text:null}}:{}}function getForcedAxisOptions(t,e){if("xAxis"!==t)return{};{const i={type:"datetime",categories:void 0};return pick(e.navigator&&e.navigator.enabled,NavigatorDefaults.enabled,!0)&&(i.startOnTick=!1,i.endOnTick=!1),i}}class StockChart extends Chart{init(e,t){const i=getOptions(),s=e.xAxis,o=e.yAxis,r=pick(e.navigator&&e.navigator.enabled,NavigatorDefaults.enabled,!0),a=(e.xAxis=e.yAxis=void 0,merge({chart:{panning:{enabled:!0,type:"x"},zooming:{pinchType:"x",mouseWheel:{type:"x"}}},navigator:{enabled:r},scrollbar:{enabled:pick(ScrollbarDefaults.enabled,!0)},rangeSelector:{enabled:pick(RangeSelectorDefaults.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(i.tooltip&&i.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},e,{isStock:!0}));e.xAxis=s,e.yAxis=o,a.xAxis=splat(e.xAxis||{}).map(t=>merge(getDefaultAxisOptions("xAxis",t,i.xAxis),t,getForcedAxisOptions("xAxis",e))),a.yAxis=splat(e.yAxis||{}).map(t=>merge(getDefaultAxisOptions("yAxis",t,i.yAxis),t)),super.init(a,t)}createAxis(t,e){return e.axis=merge(getDefaultAxisOptions(t,e.axis,getOptions()[t]),e.axis,getForcedAxisOptions(t,this.userOptions)),super.createAxis(t,e)}}addEvent(Chart,"update",function(t){const e=this,i=t.options;"scrollbar"in i&&e.navigator&&(merge(!0,e.options.scrollbar,i.scrollbar),e.navigator.update({enabled:!!e.navigator.navigatorEnabled}),delete i.scrollbar)}),function(s){function r(d){var p=this;if(p.crosshair&&p.crosshair.label&&p.crosshair.label.enabled&&p.cross&&isNumber(p.min)&&isNumber(p.max)){const g=p.chart,f=p.logarithmic,x=p.crosshair.label,u=p.horiz,b=p.opposite,m=p.left,A=p.top,v=p.width,y="inside"===p.options.tickPosition,k=!1!==p.crosshair.snap,S=d.e||p.cross&&p.cross.e,D=d.point;let t=p.crossLabel,e,i,s=x.format,o="",r,a=0,n=p.min,l=p.max;f&&(n=f.lin2log(p.min),l=f.lin2log(p.max));var d=u?"center":b?"right"===p.labelAlign?"right":"left":"left"===p.labelAlign?"left":"center",d=(t||(t=p.crossLabel=g.renderer.label("",0,void 0,x.shape||"callout").addClass("highcharts-crosshair-label highcharts-color-"+(D&&D.series?D.series.colorIndex:p.series[0]&&this.series[0].colorIndex)).attr({align:x.align||d,padding:pick(x.padding,8),r:pick(x.borderRadius,3),zIndex:2}).add(p.labelGroup),g.styledMode||t.attr({fill:x.backgroundColor||D&&D.series&&D.series.color||"#666666",stroke:x.borderColor||"","stroke-width":x.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"0.7em",textAlign:"center"},x.style||{}))),i=u?(e=k?(D.plotX||0)+m:S.chartX,A+(b?0:p.height)):(e=m+p.offset+(b?v:0),k?(D.plotY||0)+A:S.chartY),s||x.formatter||(p.dateTime&&(o="%b %d, %Y"),s="{value"+(o?":"+o:"")+"}"),k?p.isXAxis?D.x:D.y:p.toValue(u?S.chartX:S.chartY)),h=D&&D.series?D.series.isPointInside(D):isNumber(d)&&d>n&&d<l;let c="";s?c=format(s,{value:d},g):x.formatter&&isNumber(d)&&(c=x.formatter.call(p,d)),t.attr({text:c,x:e,y:i,visibility:h?"inherit":"hidden"});d=t.getBBox(),h=(!isNumber(t.x)||u||b||(e=t.x-d.width/2),isNumber(t.y)&&(u?(y&&!b||!y&&b)&&(i=t.y-d.height):i=t.y-d.height/2),r=u?{left:m,right:m+p.width}:{left:"left"===p.labelAlign?m:0,right:"right"===p.labelAlign?m+p.width:g.chartWidth},t.translateX||0);h<r.left&&(a=r.left-h),h+d.width>=r.right&&(a=-(h+d.width-r.right)),t.attr({x:e+a,y:i,anchorX:u?e:p.opposite?0:g.chartWidth,anchorY:u?p.opposite?g.chartHeight:0:i+d.height/2})}}function a(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}function n(t){const e=this,i=e.chart,s=e.options,o=i._labelPanes=i._labelPanes||{},r=s.labels;var a;i.options.isStock&&"yAxis"===e.coll&&(a=s.top+","+s.height,!o[a]&&r.enabled&&(15===r.distance&&1===e.side&&(r.distance=0),void 0===r.align&&(r.align="right"),o[a]=e,t.align="right",t.preventDefault()))}function l(){const t=this,e=t.chart,i=t.options&&t.options.top+","+t.options.height;i&&e._labelPanes&&e._labelPanes[i]===t&&delete e._labelPanes[i]}function c(t){const s=this,o=(s.isLinked&&!s.series&&s.linkedParent?s.linkedParent:s).series,r=s.chart,e=r.renderer,i=s.left,a=s.top,n=[],l=t.translatedValue,c=t.value,d=t.force;let p,h,g,f,x=[],u,b;if(r.options.isStock&&!1!==t.acrossPanes&&"xAxis"===s.coll||"yAxis"===s.coll){t.preventDefault(),x=(t=>{const e="xAxis"===t?"yAxis":"xAxis",i=s.options[e];return isNumber(i)?[r[e][i]]:isString(i)?[r.get(i)]:o.map(t=>t[e])})(s.coll);for(const A of s.isXAxis?r.yAxis:r.xAxis){var m;defined(A.options.id)&&-1!==A.options.id.indexOf("navigator")||(m=A.isXAxis?"yAxis":"xAxis",m=defined(A.options[m])?r[m][A.options[m]]:r[m][0],s===m&&x.push(A))}u=x.length?[]:[(s.isXAxis?r.yAxis:r.xAxis)[0]];for(const v of x)-1!==u.indexOf(v)||find(u,t=>t.pos===v.pos&&t.len===v.len)||u.push(v);if(b=pick(l,s.translate(c||0,void 0,void 0,t.old)),isNumber(b))if(s.horiz)for(const y of u){let t;h=y.pos,f=h+y.len,p=g=Math.round(b+s.transB),"pass"!==d&&(p<i||p>i+s.width)&&(d?p=g=clamp(p,i,i+s.width):t=!0),t||n.push(["M",p,h],["L",g,f])}else for(const k of u){let t;p=k.pos,g=p+k.len,h=f=Math.round(a+s.height-b),"pass"!==d&&(h<a||h>a+s.height)&&(d?h=f=clamp(h,a,a+s.height):t=!0),t||n.push(["M",p,h],["L",g,f])}t.path=0<n.length?e.crispPolyLine(n,t.lineWidth||1):void 0}}function d(e){var i=this;if(i.chart.options.isStock){let t;i.is("column")||i.is("columnrange")?t={borderWidth:0,shadow:!1}:i.is("scatter")||i.is("sma")||(t={marker:{enabled:!1,radius:2}}),t&&(e.plotOptions[i.type]=merge(e.plotOptions[i.type],t))}}function p(){var t=this.chart,e=this.options.dataGrouping;return!1!==this.allowDG&&e&&pick(e.enabled,t.options.isStock)}function h(e,i){for(let t=0;t<e.length;t+=2){const s=e[t],o=e[t+1];defined(s[1])&&s[1]===o[1]&&(s[1]=o[1]=crisp(s[1],i)),defined(s[2])&&s[2]===o[2]&&(s[2]=o[2]=crisp(s[2],i))}return e}s.compose=function(t,e,i,s){const o=i.prototype;o.forceCropping||(addEvent(e,"afterDrawCrosshair",r),addEvent(e,"afterHideCrosshair",a),addEvent(e,"autoLabelAlign",n),addEvent(e,"destroy",l),addEvent(e,"getPlotLinePath",c),t.prototype.setFixedRange=setFixedRange,o.forceCropping=p,addEvent(i,"setOptions",d),s.prototype.crispPolyLine=h)},s.stockChart=function(t,e,i){return new s(t,e,i)}}(StockChart=StockChart||{});export default StockChart;